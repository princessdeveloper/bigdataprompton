<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>Teampling - íŒ€ì› ì…ë ¥ (ì‹œì—°ìš©)</title>
  <style>
    :root {
      --primary-color: #4A90E2;
      --secondary-color: #90D5FF;
      --bg-color: #f4f7f9;
      --card-bg: #ffffff;
      --text-main: #333;
      --text-sub: #666;
      --border-radius: 12px;
    }
    body {
      font-family: 'Pretendard', sans-serif;
      background-color: var(--bg-color);
      color: var(--text-main);
      line-height: 1.6;
      margin: 0;
      padding: 20px;
    }
    .container { max-width: 800px; margin: 0 auto; }
    header { text-align: center; margin-bottom: 40px; }
    h1 { color: var(--primary-color); font-size: 2.5rem; margin-bottom: 10px; }
    h2 { border-bottom: 2px solid var(--secondary-color); padding-bottom: 8px; margin-top: 30px; font-size: 1.4rem; color: #444; }
    .card {
      background: var(--card-bg);
      padding: 25px;
      border-radius: var(--border-radius);
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
      margin-bottom: 25px;
    }
    input[type="text"], select {
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 1rem;
      width: 100%;
      box-sizing: border-box;
      margin-bottom: 10px;
    }
    button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.3s;
    }
    button:hover { background-color: #357abd; }
    .btn-purple { background-color: #6c5ce7; width: 100%; }
    .btn-purple:hover { background-color: #5646c7; }
    .btn-green { background-color: #00b894; width: 100%; }
    .btn-green:hover { background-color: #009b7b; }
    .character-info-box {
      background-color: #f0f9ff;
      border: 1px solid var(--secondary-color);
      border-radius: var(--border-radius);
      padding: 15px;
      margin: 15px 0;
      font-size: 0.9rem;
      max-height: 300px;
      overflow-y: auto;
    }
    .checkbox-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }
    #output {
      background: #2d3436;
      color: #dfe6e9;
      padding: 15px;
      border-radius: 8px;
      font-family: monospace;
      font-size: 0.85rem;
      white-space: pre-wrap;
    }
    .status-msg { color: var(--primary-color); font-weight: bold; margin-top: 10px; }
    fieldset { border: 1px solid #eee; border-radius: 8px; padding: 15px; margin-bottom: 15px; }
    legend { font-weight: bold; color: var(--text-main); }
  </style>
</head>
<body>

<div class="container">
  <header>
    <h1>ğŸš€ Teampling</h1>
    <p>íŒ€ì› ì…ë ¥ â†’ ì„œë²„ ìë™ ë¶„ì„ â†’ LaaSì—ì„œ íŒ€ ì½”ë“œë§Œìœ¼ë¡œ ì—­í•  ë¶„ë‹´</p>
  </header>

  <div class="card">
    <h2>1) íŒ€ ì½”ë“œ ìƒì„±/ì…ë ¥</h2>
    <p id="baseText" class="status-msg"></p>

    <button id="createTeamBtn" class="btn-purple">ìƒˆ íŒ€ ì½”ë“œ ìƒì„±í•˜ê¸°</button>
    <div style="margin-top:15px;">
      <label>í˜„ì¬ íŒ€ ì½”ë“œ:</label>
      <input id="teamCode" placeholder="ì˜ˆ: A3F91C">
    </div>
    <p id="teamCodeText" class="status-msg"></p>
  </div>

  <div class="card">
    <h2>2) í”„ë¡œì íŠ¸ ì •ë³´ ì„¤ì •</h2>
    <form id="teamMetaForm">
      <p><b>ì „ê³µ</b></p>
      <input name="major" placeholder="ì˜ˆ: ì»´í“¨í„°ê³µí•™" required>

      <p><b>í”„ë¡œì íŠ¸ ìœ í˜•</b></p>
      <select name="project_type" required>
        <option value="ë°œí‘œ ì¤‘ì‹¬í˜•">ë°œí‘œ ì¤‘ì‹¬í˜•</option>
        <option value="ë³´ê³ ì„œ ì¤‘ì‹¬í˜•">ë³´ê³ ì„œ ì¤‘ì‹¬í˜•</option>
        <option value="ê°œë°œ/ì œì‘í˜•">ê°œë°œ/ì œì‘í˜•</option>
        <option value="ì¡°ì‚¬/ë¶„ì„í˜•">ì¡°ì‚¬/ë¶„ì„í˜•</option>
        <option value="í˜¼í•©í˜•">í˜¼í•©í˜•</option>
      </select>

      <button type="submit" style="width:100%; margin-top: 10px;">íŒ€ ì •ë³´ ì €ì¥</button>
    </form>
  </div>

  <div class="card">
    <h2>3) íŒ€ì› ìƒì„¸ ì…ë ¥</h2>
    <form id="memberForm">
      <p><b>ì´ë¦„</b></p>
      <input name="name" required placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">

      <p><b>MBTI</b></p>
      <select name="mbti" required>
        <option>INTJ</option><option>INTP</option><option>ENTJ</option><option>ENTP</option>
        <option>INFJ</option><option>INFP</option><option>ENFJ</option><option>ENFP</option>
        <option>ISTJ</option><option>ISFJ</option><option>ESTJ</option><option>ESFJ</option>
        <option>ISTP</option><option>ISFP</option><option>ESTP</option><option>ESFP</option>
      </select>

      <p><b>ë‚˜ì˜ ìºë¦­í„° ì„ íƒ</b></p>
      <select name="character" required>
        <option value="" disabled selected>ë‚´ ìºë¦­í„° ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”</option>
        <option value="Captain">ğŸ›¡ï¸ ë“ ë“ í•œ ì´ëŒ€(Captain)</option>
        <option value="Specialist">ğŸ› ï¸ ê°“ìƒ ì‹¤ë¬´ì(Specialist)</option>
        <option value="Ideator">ğŸ’¡ ì•„ì´ë””ì–´ ë±…í¬(Ideator)</option>
        <option value="Coordinator">ğŸ¯ í”„ë¡œ ë¦¬ì•¡ì…˜ëŸ¬(Coordinator)</option>
        <option value="Presenter">ğŸ¤ ë¬´ëŒ€ ì²´ì§ˆ ë°œí‘œì(Presenter)</option>
      </select>

      <fieldset>
        <legend>ğŸ‘ ì„ í˜¸ ì‘ì—…</legend>
        <div class="checkbox-grid">
          <label><input type="checkbox" name="preferred" value="ì¼ì •/ì´ê´„"> ì¼ì •/ì´ê´„</label>
          <label><input type="checkbox" name="preferred" value="ìë£Œì¡°ì‚¬"> ìë£Œì¡°ì‚¬</label>
          <label><input type="checkbox" name="preferred" value="ë¬¸ì„œ/ë³´ê³ ì„œ"> ë¬¸ì„œ/ë³´ê³ ì„œ</label>
          <label><input type="checkbox" name="preferred" value="PPT"> PPT</label>
          <label><input type="checkbox" name="preferred" value="íšŒì˜ë¡"> íšŒì˜ë¡</label>
          <label><input type="checkbox" name="preferred" value="ì¤‘ì¬"> ì¤‘ì¬</label>
          <label><input type="checkbox" name="preferred" value="ë°œí‘œ"> ë°œí‘œ</label>
          <label><input type="checkbox" name="preferred" value="Q&A"> Q&A</label>
        </div>
      </fieldset>

      <fieldset>
        <legend>ğŸ‘ ë¹„ì„ í˜¸ ì‘ì—…</legend>
        <div class="checkbox-grid">
          <label><input type="checkbox" name="avoid" value="ì¼ì •/ì´ê´„"> ì¼ì •/ì´ê´„</label>
          <label><input type="checkbox" name="avoid" value="ìë£Œì¡°ì‚¬"> ìë£Œì¡°ì‚¬</label>
          <label><input type="checkbox" name="avoid" value="ë¬¸ì„œ/ë³´ê³ ì„œ"> ë¬¸ì„œ/ë³´ê³ ì„œ</label>
          <label><input type="checkbox" name="avoid" value="PPT"> PPT</label>
          <label><input type="checkbox" name="avoid" value="íšŒì˜ë¡"> íšŒì˜ë¡</label>
          <label><input type="checkbox" name="avoid" value="ì¤‘ì¬"> ì¤‘ì¬</label>
          <label><input type="checkbox" name="avoid" value="ë°œí‘œ"> ë°œí‘œ</label>
          <label><input type="checkbox" name="avoid" value="Q&A"> Q&A</label>
        </div>
      </fieldset>

      <fieldset>
        <legend>â­ í•´ë³¸ ê²½í—˜ ìˆëŠ” ì‘ì—… (ê°€ì‚°ì )</legend>
        <div class="checkbox-grid">
          <label><input type="checkbox" name="experience" value="ì¼ì •/ì´ê´„"> ì¼ì •/ì´ê´„</label>
          <label><input type="checkbox" name="experience" value="ìë£Œì¡°ì‚¬"> ìë£Œì¡°ì‚¬</label>
          <label><input type="checkbox" name="experience" value="ë¬¸ì„œ/ë³´ê³ ì„œ"> ë¬¸ì„œ/ë³´ê³ ì„œ</label>
          <label><input type="checkbox" name="experience" value="PPT"> PPT</label>
          <label><input type="checkbox" name="experience" value="íšŒì˜ë¡"> íšŒì˜ë¡</label>
          <label><input type="checkbox" name="experience" value="ì¤‘ì¬"> ì¤‘ì¬</label>
          <label><input type="checkbox" name="experience" value="ë°œí‘œ"> ë°œí‘œ</label>
          <label><input type="checkbox" name="experience" value="Q&A"> Q&A</label>
        </div>
      </fieldset>

      <button type="submit" style="width:100%; height:50px; font-size:1.1rem; margin-top:10px;">íŒ€ì› ì¶”ê°€ ì™„ë£Œ</button>
    </form>
    <p id="countText" class="status-msg" style="text-align:center;"></p>
  </div>

  <div class="card">
    <h2>ë””ë²„ê·¸ ë¡œê·¸</h2>
    <pre id="output">ì„œë²„ ì‘ë‹µì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</pre>
  </div>
</div>

<script>
  // âœ… BASE URL ìë™ ì„¤ì • (ì‚¬ìš©ì ì…ë ¥ ë¶ˆí•„ìš”)
  const BASE = window.location.origin;
  document.getElementById("baseText").textContent = `âœ… ì„œë²„ ì£¼ì†Œ ìë™ ì ìš©ë¨: ${BASE}`;

  function getTeamCode() {
    return document.getElementById("teamCode").value.trim().toUpperCase();
  }
  function checkedValues(name) {
    return Array.from(document.querySelectorAll(`input[name="${name}"]:checked`)).map(x => x.value);
  }
  function setOutput(obj) {
    document.getElementById("output").textContent = JSON.stringify(obj, null, 2);
  }

  document.getElementById("createTeamBtn").onclick = async () => {
    try {
      const res = await fetch(`${BASE}/create_team`, { method: "POST" });
      const result = await res.json();
      setOutput(result);

      if (result.team_code) {
        document.getElementById("teamCode").value = result.team_code;
        document.getElementById("teamCodeText").textContent = `âœ… ìƒˆ íŒ€ ì½”ë“œ: ${result.team_code}`;
      }
    } catch (e) {
      document.getElementById("teamCodeText").textContent = `âŒ ì„œë²„ ì—°ê²° ì˜¤ë¥˜: ${e.message}`;
    }
  };

  document.getElementById("teamMetaForm").onsubmit = async (e) => {
    e.preventDefault();
    const code = getTeamCode();
    if (!code) return alert("íŒ€ ì½”ë“œë¥¼ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”.");

    const data = { major: e.target.major.value, project_type: e.target.project_type.value };
    const res = await fetch(`${BASE}/set_team/${code}`, {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify(data)
    });

    const result = await res.json();
    setOutput(result);

    if (res.ok) alert("íŒ€ ì •ë³´ ì €ì¥ ì™„ë£Œ!");
    else alert(result.error || "íŒ€ ì •ë³´ ì €ì¥ ì‹¤íŒ¨");
  };

  document.getElementById("memberForm").onsubmit = async (e) => {
    e.preventDefault();
    const code = getTeamCode();
    if (!code) return alert("íŒ€ ì½”ë“œë¥¼ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”.");

    const data = {
      name: e.target.name.value,
      mbti: e.target.mbti.value,
      character: e.target.character.value,
      preferred_tasks: checkedValues("preferred"),
      avoid_tasks: checkedValues("avoid"),
      experience_tasks: checkedValues("experience")
    };

    const res = await fetch(`${BASE}/submit/${code}`, {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify(data)
    });

    const result = await res.json();
    setOutput(result);

    if (res.ok) {
      document.getElementById("countText").textContent = `í˜„ì¬ íŒ€ì› ìˆ˜: ${result.count ?? "?"}ëª…`;
      e.target.reset();
      alert(`${data.name} íŒ€ì› ì¶”ê°€ ì™„ë£Œ!`);
    } else {
      alert(result.error || "íŒ€ì› ì¶”ê°€ ì‹¤íŒ¨");
    }
  };
</script>

</body>
</html>
